{% style %}
  .announcement-swiper-{{ section.id }} {
    background-color: {{ section.settings.background_color }};
    color: {{ section.settings.text_color }};
    padding: {{ section.settings.padding_top }}px 0 {{ section.settings.padding_bottom }}px 0;
  }

  .announcement-swiper-{{ section.id }} .swiper-slide {
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: {{ section.settings.font_size }}px;
    font-weight: {{ section.settings.font_weight }};
    text-align: center;
    width: 100%;
  }

  .announcement-swiper-{{ section.id }} .swiper-slide a {
    color: inherit;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    justify-content: center;
  }

  .announcement-swiper-{{ section.id }} .swiper-slide a:hover {
    text-decoration: underline;
  }

  @media (max-width: 768px) {
    .announcement-swiper-{{ section.id }} {
      padding: {{ section.settings.padding_top | times: 0.75 | round }}px 0 {{ section.settings.padding_bottom | times: 0.75 | round }}px 0;
    }
    
    .announcement-swiper-{{ section.id }} .swiper-slide {
      font-size: {{ section.settings.mobile_font_size | default: section.settings.font_size }}px;
    }
  }
{% endstyle %}

<div class="announcement-swiper-{{ section.id }}">
  <div class="swiper page-width announcement-swiper" data-swiper-config='{
    "autoplay": {
      "delay": {{ section.settings.autoplay_delay | default: 5 | times: 1000 }},
      "disableOnInteraction": false,
      "pauseOnMouseEnter": true
    },
    "loop": true,
    "speed": {{ section.settings.transition_speed | default: 1000 }},
    "effect": "slide",
    "direction": "horizontal",
    "allowTouchMove": true,
    "grabCursor": true
  }'>
    <div class="swiper-wrapper">
      {%- for block in section.blocks -%}
        {%- if block.type == 'announcement' and block.settings.text != blank -%}
          <div class="swiper-slide" {{ block.shopify_attributes }}>
            {%- if block.settings.link != blank -%}
              <a href="{{ block.settings.link }}">
                {{ block.settings.text }}
                <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
                  <path d="M6 0L7.5 1.5L4.5 4.5H12V7.5H4.5L7.5 10.5L6 12L0 6L6 0Z"/>
                </svg>
              </a>
            {%- else -%}
              {{ block.settings.text }}
            {%- endif -%}
          </div>
        {%- endif -%}
      {%- endfor -%}
    </div>
  </div>
</div>

<script>
  function setupSwiper{{ section.id | replace: '-', '' }}() {
    const swiperEl = document.querySelector('.announcement-swiper-{{ section.id }} .swiper');
    if (swiperEl) {
      const swiperConfig = JSON.parse(swiperEl.getAttribute('data-swiper-config'));
      
      // Initialize Swiper with autoplay
      const swiper = new Swiper(swiperEl, {
        ...swiperConfig,
      });
      
      // Ensure autoplay is running
      if (swiper && swiper.autoplay) {
        swiper.autoplay.start();
      }
    }
  }
  document.addEventListener('DOMContentLoaded', function() {
    setupSwiper{{ section.id | replace: '-', '' }}();
  });
  if (Shopify.designMode) {
    document.addEventListener('shopify:section:load', function() {
      setupSwiper{{ section.id | replace: '-', '' }}();
    });
  }
</script>

{% schema %}
{
  "name": "t:sections.announcement-bar.name",
  "max_blocks": 12,
  "settings": [
    {
      "type": "header",
      "content": "t:sections.announcement-bar.settings.general_settings.content"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "t:sections.announcement-bar.settings.background_color.label",
      "default": "#1E1E1E"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "t:sections.announcement-bar.settings.text_color.label",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "t:sections.announcement-bar.settings.swiper_settings.content"
    },
    {
      "type": "range",
      "id": "autoplay_delay",
      "min": 2,
      "max": 20,
      "step": 1,
      "unit": "s",
      "label": "t:sections.announcement-bar.settings.autoplay_delay.label",
      "default": 5
    },
    {
      "type": "range",
      "id": "transition_speed",
      "min": 300,
      "max": 2000,
      "step": 100,
      "unit": "ms",
      "label": "t:sections.announcement-bar.settings.transition_speed.label",
      "default": 1000
    },
    {
      "type": "header",
      "content": "t:sections.announcement-bar.settings.typography.content"
    },
    {
      "type": "range",
      "id": "font_size",
      "label": "t:sections.announcement-bar.settings.font_size.label",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "range",
      "id": "mobile_font_size",
      "label": "t:sections.announcement-bar.settings.mobile_font_size.label",
      "min": 10,
      "max": 20,
      "step": 1,
      "unit": "px",
      "default": 14
    },
    {
      "type": "select",
      "id": "font_weight",
      "options": [
        {
          "value": "normal",
          "label": "t:sections.announcement-bar.settings.font_weight.options__1.label"
        },
        {
          "value": "bold",
          "label": "t:sections.announcement-bar.settings.font_weight.options__2.label"
        }
      ],
      "default": "normal",
      "label": "t:sections.announcement-bar.settings.font_weight.label"
    },
    {
      "type": "header",
      "content": "t:sections.announcement-bar.settings.spacing.content"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 30,
      "step": 1,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 15
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 30,
      "step": 1,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 15
    }
  ],
  "blocks": [
    {
      "type": "announcement",
      "name": "t:sections.announcement-bar.blocks.announcement.name",
      "settings": [
        {
          "type": "inline_richtext",
          "id": "text",
          "default": "Free shipping on orders over $50 | Fast worldwide delivery",
          "label": "t:sections.announcement-bar.blocks.announcement.settings.text.label"
        },
        {
          "type": "url",
          "id": "link",
          "label": "t:sections.announcement-bar.blocks.announcement.settings.link.label"
        }
      ]
    }
  ],
  "default": {
    "blocks": [
      {
        "type": "announcement",
        "settings": {
          "text": "Free shipping on orders over $50"
        }
      },
      {
        "type": "announcement",
        "settings": {
          "text": "Fast worldwide delivery"
        }
      },
      {
        "type": "announcement",
        "settings": {
          "text": "30-day money-back guarantee"
        }
      }
    ]
  }
}
{% endschema %}
