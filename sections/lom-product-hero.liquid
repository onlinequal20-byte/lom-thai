{{ 'lom-natural.css' | asset_url | stylesheet_tag }}

{%- assign product = product -%}

<section class="lom-product-hero">
  <div class="lom-container--wide">
    <div class="lom-product-hero__grid">
      {%- comment -%} Gallery {%- endcomment -%}
      <div class="lom-product-hero__gallery">
        <div class="lom-product-hero__main-image" id="lom-main-image">
          {% if product.featured_image %}
            <img src="{{ product.featured_image | image_url: width: 1200 }}" alt="{{ product.featured_image.alt | default: product.title }}" id="lom-product-img" loading="eager">
          {% endif %}
        </div>
        {% if product.images.size > 1 %}
          <div class="lom-product-hero__thumbs">
            {% for image in product.images %}
              <button class="lom-product-hero__thumb {% if forloop.first %}is-active{% endif %}" onclick="document.getElementById('lom-product-img').src='{{ image | image_url: width: 1200 }}'; document.querySelectorAll('.lom-product-hero__thumb').forEach(function(t){t.classList.remove('is-active')}); this.classList.add('is-active');">
                <img src="{{ image | image_url: width: 120 }}" alt="{{ image.alt | default: product.title }}" loading="lazy" width="120">
              </button>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      {%- comment -%} Product Info {%- endcomment -%}
      <div class="lom-product-hero__info">
        <div class="lom-product-hero__breadcrumb">
          <a href="/">Home</a> / <a href="/collections/all">Shop</a> / <span>{{ product.title }}</span>
        </div>

        {%- comment -%} Social proof mini {%- endcomment -%}
        <div class="lom-product-hero__proof">
          <span class="lom-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
          <span>{{ section.settings.review_count }} Reviews</span>
        </div>

        <h1 class="lom-product-hero__title">{{ product.title }}</h1>

        {% if section.settings.subtitle != blank %}
          <p class="lom-product-hero__subtitle">{{ section.settings.subtitle }}</p>
        {% endif %}

        {%- comment -%} Urgency timer {%- endcomment -%}
        {% if section.settings.show_urgency %}
          <div class="lom-urgency">
            <div class="lom-urgency__bar">
              <div class="lom-urgency__progress" id="lom-urgency-progress"></div>
            </div>
            <div class="lom-urgency__content">
              <span class="lom-urgency__icon">üî•</span>
              <span class="lom-urgency__text">{{ section.settings.urgency_text | default: 'Sale ends in' }}</span>
              <div class="lom-urgency__timer" id="lom-urgency-timer">
                <div class="lom-urgency__unit">
                  <span class="lom-urgency__number" id="lom-timer-hours">00</span>
                  <span class="lom-urgency__label">hrs</span>
                </div>
                <span class="lom-urgency__sep">:</span>
                <div class="lom-urgency__unit">
                  <span class="lom-urgency__number" id="lom-timer-minutes">00</span>
                  <span class="lom-urgency__label">min</span>
                </div>
                <span class="lom-urgency__sep">:</span>
                <div class="lom-urgency__unit">
                  <span class="lom-urgency__number" id="lom-timer-seconds">00</span>
                  <span class="lom-urgency__label">sec</span>
                </div>
              </div>
            </div>
            {% if section.settings.urgency_subtext != blank %}
              <p class="lom-urgency__subtext">{{ section.settings.urgency_subtext }}</p>
            {% endif %}
          </div>
        {% endif %}

        <div class="lom-product-hero__price">
          {% if product.compare_at_price > product.price %}
            <span class="lom-product-hero__price-compare">{{ product.compare_at_price | money }}</span>
          {% endif %}
          <span class="lom-product-hero__price-current">{{ product.price | money }}</span>
          {% if product.compare_at_price > product.price %}
            {% assign savings = product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price %}
            <span class="lom-product-hero__price-save">Save {{ savings }}%</span>
          {% endif %}
        </div>

        {%- comment -%} Variant picker {%- endcomment -%}
        {% if product.has_only_default_variant == false %}
          {% for option in product.options_with_values %}
            <div class="lom-product-hero__option">
              <label class="lom-product-hero__option-label">{{ option.name }}</label>
              <div class="lom-product-hero__option-values">
                {% for value in option.values %}
                  <button class="lom-product-hero__option-btn {% if option.selected_value == value %}is-active{% endif %}">{{ value }}</button>
                {% endfor %}
              </div>
            </div>
          {% endfor %}
        {% endif %}

        {%- comment -%} Bundle offer {%- endcomment -%}
        {% if section.settings.show_bundle %}
          <div class="lom-product-hero__bundles">
            <div class="lom-product-hero__bundle is-active" data-quantity="1">
              <div class="lom-product-hero__bundle-radio"></div>
              <div class="lom-product-hero__bundle-info">
                <strong>1x Lom Thai</strong>
                <span>Try it out</span>
              </div>
              <div class="lom-product-hero__bundle-price">{{ product.price | money }}</div>
            </div>
            <div class="lom-product-hero__bundle lom-product-hero__bundle--popular" data-quantity="3">
              <span class="lom-product-hero__bundle-badge">Most Popular</span>
              <div class="lom-product-hero__bundle-radio"></div>
              <div class="lom-product-hero__bundle-info">
                <strong>3x Lom Thai</strong>
                <span>One for every bag</span>
              </div>
              <div class="lom-product-hero__bundle-price">
                <small class="lom-product-hero__bundle-was">{{ product.price | times: 3 | money }}</small>
                {{ product.price | times: 3 | times: 80 | divided_by: 100 | money }}
              </div>
            </div>
            <div class="lom-product-hero__bundle" data-quantity="5">
              <span class="lom-product-hero__bundle-badge lom-product-hero__bundle-badge--value">Best Value</span>
              <div class="lom-product-hero__bundle-radio"></div>
              <div class="lom-product-hero__bundle-info">
                <strong>5x Lom Thai</strong>
                <span>Share with family</span>
              </div>
              <div class="lom-product-hero__bundle-price">
                <small class="lom-product-hero__bundle-was">{{ product.price | times: 5 | money }}</small>
                {{ product.price | times: 5 | times: 70 | divided_by: 100 | money }}
              </div>
            </div>
          </div>
        {% endif %}

        {%- comment -%} Guarantee badges {%- endcomment -%}
        <div class="lom-product-hero__guarantees">
          <div class="lom-product-hero__guarantee">
            <span class="lom-product-hero__guarantee-icon">üõ°Ô∏è</span>
            <span>30-Day Guarantee</span>
          </div>
          <div class="lom-product-hero__guarantee">
            <span class="lom-product-hero__guarantee-icon">üöö</span>
            <span>Free Shipping</span>
          </div>
          <div class="lom-product-hero__guarantee">
            <span class="lom-product-hero__guarantee-icon">üîí</span>
            <span>Secure Checkout</span>
          </div>
        </div>

        {%- comment -%} Add to Cart {%- endcomment -%}
        {% form 'product', product, id: 'lom-product-form' %}
          <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
          <button type="submit" class="lom-btn-primary lom-btn-full lom-product-hero__atc" {% unless product.available %}disabled{% endunless %}>
            {% if product.available %}
              {{ section.settings.atc_text | default: 'Add to Cart' }} ‚Äî {{ product.price | money }}
            {% else %}
              Sold Out
            {% endif %}
          </button>
        {% endform %}

        {%- comment -%} Social proof buyers bar {%- endcomment -%}
        <div class="lom-hero-buyers">
          <div class="lom-hero-buyers__avatars">
            <span class="lom-hero-buyers__avatar" style="background:#c5d9c7;z-index:4">S</span>
            <span class="lom-hero-buyers__avatar" style="background:#e8c9b8;z-index:3">M</span>
            <span class="lom-hero-buyers__avatar" style="background:#b8cfe8;z-index:2">J</span>
          </div>
          <span class="lom-hero-buyers__text">{{ section.settings.buyers_text | default: 'Sarah and 438 people purchased' }}</span>
        </div>

        {%- comment -%} Payment icons {%- endcomment -%}
        <div class="lom-hero-payments">
          <div class="lom-hero-payments__track">
            {%- for type in shop.enabled_payment_types -%}
              <span class="lom-hero-payments__icon">{{ type | payment_type_svg_tag: class: 'lom-payment-svg' }}</span>
            {%- endfor -%}
          </div>
        </div>

        {%- comment -%} Trust row: Safe Payment / Free Shipping / Fast Delivery {%- endcomment -%}
        <div class="lom-hero-trust-row">
          <div class="lom-hero-trust-row__item">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v2m0 8h.01"/><path d="M9.5 10.5a2.5 2.5 0 115 0c0 1.5-2.5 2-2.5 4"/></svg>
            <span>Safe Payment</span>
          </div>
          <div class="lom-hero-trust-row__item">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3 7h7l-5.5 4 2 7L12 16l-6.5 4 2-7L2 9h7z"/></svg>
            <span>Free Shipping</span>
          </div>
          <div class="lom-hero-trust-row__item">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
            <span>Fast Delivery</span>
          </div>
        </div>

        {%- comment -%} Featured review carousel {%- endcomment -%}
        {% assign review_blocks = section.blocks | where: 'type', 'review' %}
        {% if review_blocks.size > 0 %}
          <div class="lom-hero-review-carousel" id="lom-review-carousel">
            {% for block in review_blocks %}
              <div class="lom-hero-review-card {% if forloop.first %}is-active{% endif %}" {{ block.shopify_attributes }}>
                <div class="lom-hero-review-card__inner">
                  <div class="lom-hero-review-card__avatar">
                    {{ block.settings.name | truncate: 1, '' | upcase }}
                  </div>
                  <div class="lom-hero-review-card__info">
                    <div class="lom-hero-review-card__name">
                      {{ block.settings.name }}
                      <span class="lom-hero-review-card__verified">‚úì</span>
                    </div>
                    <div class="lom-hero-review-card__location">{{ block.settings.location }}</div>
                    <div class="lom-hero-review-card__stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                    <p class="lom-hero-review-card__text">{{ block.settings.text }}</p>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
          <div class="lom-hero-review-nav">
            <strong>{{ review_blocks.size }}</strong> <span>New Reviews</span>
            <div class="lom-hero-review-dots" id="lom-review-dots">
              {% for block in review_blocks %}
                <span class="lom-hero-review-dot {% if forloop.first %}is-active{% endif %}" data-index="{{ forloop.index0 }}"></span>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        {%- comment -%} Collapsible accordions {%- endcomment -%}
        {% assign accordion_blocks = section.blocks | where: 'type', 'accordion' %}
        {% if accordion_blocks.size > 0 %}
          <div class="lom-hero-accordions">
            {% for block in accordion_blocks %}
              <div class="lom-hero-accordion" {{ block.shopify_attributes }}>
                <button class="lom-hero-accordion__trigger" onclick="this.parentElement.classList.toggle('is-open')">
                  <span>{{ block.settings.heading }}</span>
                  <span class="lom-hero-accordion__icon">+</span>
                </button>
                <div class="lom-hero-accordion__content">
                  <div class="lom-hero-accordion__body">{{ block.settings.content }}</div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>

{%- comment -%} Sticky mobile ATC bar {%- endcomment -%}
<div class="lom-sticky-atc" id="lom-sticky-atc">
  <div class="lom-sticky-atc__inner">
    <div class="lom-sticky-atc__info">
      <div class="lom-sticky-atc__title">{{ product.title }}</div>
      <div class="lom-sticky-atc__price">{{ product.price | money }}{% if product.compare_at_price > product.price %} <s style="color:var(--lom-text-light);font-size:12px">{{ product.compare_at_price | money }}</s>{% endif %}</div>
    </div>
    <button class="lom-sticky-atc__btn" onclick="document.getElementById('lom-product-form').querySelector('button[type=submit]').click()">
      Add to Cart
    </button>
  </div>
</div>

<script>
  // Urgency countdown timer
  (function(){
    var hoursEl = document.getElementById('lom-timer-hours');
    var minsEl = document.getElementById('lom-timer-minutes');
    var secsEl = document.getElementById('lom-timer-seconds');
    var progressEl = document.getElementById('lom-urgency-progress');
    if (!hoursEl) return;

    var totalHours = {{ section.settings.urgency_hours | default: 6 }};
    var storageKey = 'lom_urgency_end';
    var stored = localStorage.getItem(storageKey);
    var endTime;

    if (stored && parseInt(stored) > Date.now()) {
      endTime = parseInt(stored);
    } else {
      endTime = Date.now() + (totalHours * 60 * 60 * 1000);
      localStorage.setItem(storageKey, endTime);
    }

    var totalMs = totalHours * 60 * 60 * 1000;

    function tick() {
      var remaining = endTime - Date.now();
      if (remaining <= 0) {
        endTime = Date.now() + totalMs;
        localStorage.setItem(storageKey, endTime);
        remaining = totalMs;
      }
      var h = Math.floor(remaining / 3600000);
      var m = Math.floor((remaining % 3600000) / 60000);
      var s = Math.floor((remaining % 60000) / 1000);
      hoursEl.textContent = h < 10 ? '0' + h : h;
      minsEl.textContent = m < 10 ? '0' + m : m;
      secsEl.textContent = s < 10 ? '0' + s : s;
      if (progressEl) {
        progressEl.style.width = ((remaining / totalMs) * 100) + '%';
      }
    }
    tick();
    setInterval(tick, 1000);
  })();

  // Bundle selector
  document.querySelectorAll('.lom-product-hero__bundle').forEach(function(b){
    b.addEventListener('click', function(){
      document.querySelectorAll('.lom-product-hero__bundle').forEach(function(x){x.classList.remove('is-active')});
      this.classList.add('is-active');
    });
  });

  // Review carousel
  (function(){
    var cards = document.querySelectorAll('.lom-hero-review-card');
    var dots = document.querySelectorAll('.lom-hero-review-dot');
    if (cards.length < 2) return;
    var idx = 0;
    function show(i) {
      cards.forEach(function(c){ c.classList.remove('is-active'); });
      dots.forEach(function(d){ d.classList.remove('is-active'); });
      cards[i].classList.add('is-active');
      dots[i].classList.add('is-active');
      idx = i;
    }
    dots.forEach(function(d){
      d.addEventListener('click', function(){ show(parseInt(this.dataset.index)); });
    });
    setInterval(function(){ show((idx + 1) % cards.length); }, 5000);
  })();

  // Sticky mobile ATC
  (function(){
    var stickyEl = document.getElementById('lom-sticky-atc');
    var atcBtn = document.querySelector('.lom-product-hero__atc');
    if (!stickyEl || !atcBtn) return;
    var observer = new IntersectionObserver(function(entries){
      entries.forEach(function(e){
        if (e.isIntersecting) {
          stickyEl.classList.remove('is-visible');
        } else {
          stickyEl.classList.add('is-visible');
        }
      });
    }, { threshold: 0 });
    observer.observe(atcBtn);
  })();
</script>

{% schema %}
{
  "name": "Lom Product Hero",
  "settings": [
    {
      "type": "text",
      "id": "subtitle",
      "label": "Product subtitle",
      "default": "2-in-1 Nasal Inhaler & Roller ‚Äî Instant natural relief for headaches, fatigue, and congestion"
    },
    {
      "type": "text",
      "id": "review_count",
      "label": "Review count",
      "default": "2,847"
    },
    {
      "type": "text",
      "id": "atc_text",
      "label": "Add to cart text",
      "default": "Add to Cart"
    },
    {
      "type": "checkbox",
      "id": "show_bundle",
      "label": "Show bundle offers",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_urgency",
      "label": "Show urgency timer",
      "default": true
    },
    {
      "type": "text",
      "id": "urgency_text",
      "label": "Urgency text",
      "default": "Sale ends in"
    },
    {
      "type": "text",
      "id": "urgency_subtext",
      "label": "Urgency subtext",
      "default": "Order now to lock in this price + free shipping"
    },
    {
      "type": "range",
      "id": "urgency_hours",
      "label": "Timer hours",
      "min": 1,
      "max": 48,
      "step": 1,
      "default": 6
    },
    {
      "type": "text",
      "id": "buyers_text",
      "label": "Buyers social proof text",
      "default": "Sarah and 438 people purchased"
    }
  ],
  "blocks": [
    {
      "type": "benefit",
      "name": "Key benefit",
      "settings": [
        {
          "type": "text",
          "id": "icon",
          "label": "Icon",
          "default": "‚ö°"
        },
        {
          "type": "text",
          "id": "text",
          "label": "Benefit text",
          "default": "Works in seconds, not minutes"
        }
      ]
    },
    {
      "type": "review",
      "name": "Featured review",
      "settings": [
        {
          "type": "text",
          "id": "name",
          "label": "Reviewer name",
          "default": "Sarah K."
        },
        {
          "type": "text",
          "id": "location",
          "label": "Location",
          "default": "Los Angeles"
        },
        {
          "type": "textarea",
          "id": "text",
          "label": "Review text",
          "default": "This thing is magic. Instant relief from my sinus headaches."
        }
      ]
    },
    {
      "type": "accordion",
      "name": "Accordion tab",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Description"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>Accordion content here.</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Lom Product Hero",
      "blocks": [
        { "type": "benefit", "settings": { "icon": "‚ö°", "text": "Works in seconds, not minutes" } },
        { "type": "benefit", "settings": { "icon": "üåø", "text": "5 natural plant-based ingredients" } },
        { "type": "benefit", "settings": { "icon": "üí∞", "text": "Only $0.03 per use ‚Äî lasts months" } },
        { "type": "review", "settings": { "name": "Sarah K.", "location": "Los Angeles", "text": "This thing is magic. Instant relief from my sinus headaches. I carry it everywhere now." } },
        { "type": "review", "settings": { "name": "James M.", "location": "New York", "text": "As a truck driver, this is a lifesaver. One sniff and I'm alert again." } },
        { "type": "review", "settings": { "name": "Anna P.", "location": "Netherlands", "text": "My whole family uses these. Best natural remedy we've found." } },
        { "type": "review", "settings": { "name": "Michelle T.", "location": "Texas", "text": "Working 12-hour nursing shifts, this keeps me going. Natural and it actually works." } },
        { "type": "accordion", "settings": { "heading": "Description", "content": "<p>Lom Thai is a 2-in-1 nasal inhaler and roller made from 5 natural Thai herbs: menthol, camphor, borneol, eucalyptus, and lemon oil. Instant relief for headaches, fatigue, congestion, and nausea.</p>" } },
        { "type": "accordion", "settings": { "heading": "Most Common Questions", "content": "<p><strong>Is this a drug?</strong> No ‚Äî 100% natural herbal aromatherapy.<br><strong>How fast does it work?</strong> Seconds. Instant effect upon inhaling.<br><strong>Is it TSA-friendly?</strong> Yes ‚Äî solid stick, pocket-sized, flight-safe.</p>" } },
        { "type": "accordion", "settings": { "heading": "Processing & Shipping", "content": "<p>Orders ship within 24 hours. Free shipping to US & EU. Delivery in 5-10 business days. 30-day money-back guarantee ‚Äî no questions asked.</p>" } }
      ]
    }
  ]
}
{% endschema %}

