{{ 'lom-natural.css' | asset_url | stylesheet_tag }}

{%- assign product = product -%}

<section class="lom-product-hero">
  <div class="lom-container--wide">
    <div class="lom-product-hero__grid">
      {%- comment -%} Gallery {%- endcomment -%}
      <div class="lom-product-hero__gallery">
        <div class="lom-product-hero__main-image" id="lom-main-image">
          {% if product.featured_image %}
            <img
              src="{{ product.featured_image | image_url: width: 1200 }}"
              alt="{{ product.featured_image.alt | default: product.title }}"
              id="lom-product-img"
              loading="eager"
              width="{{ product.featured_image.width }}"
              height="{{ product.featured_image.height }}"
            >
          {% endif %}
        </div>
        {% if product.images.size > 1 %}
          <div class="lom-product-hero__thumbs">
            {% for image in product.images %}
              <button type="button" class="lom-product-hero__thumb {% if forloop.first %}is-active{% endif %}" aria-label="View image {{ forloop.index }}" onclick="document.getElementById('lom-product-img').src='{{ image | image_url: width: 1200 }}'; document.querySelectorAll('.lom-product-hero__thumb').forEach(function(t){t.classList.remove('is-active')}); this.classList.add('is-active');">
                <img src="{{ image | image_url: width: 120 }}" alt="{{ image.alt | default: product.title }}" loading="lazy" width="120" height="120">
              </button>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      {%- comment -%} Product Info {%- endcomment -%}
      <div class="lom-product-hero__info">
        <div class="lom-product-hero__breadcrumb">
          <a href="/">Home</a> / <a href="/collections/all">Shop</a> / <span>{{ product.title }}</span>
        </div>

        {%- comment -%} Social proof mini {%- endcomment -%}
        <div class="lom-product-hero__proof">
          <span class="lom-stars"><span class="lom-star"></span><span class="lom-star"></span><span class="lom-star"></span><span class="lom-star"></span><span class="lom-star"></span></span>
          <span>{{ section.settings.review_count }} Reviews</span>
        </div>

        {% if section.settings.headline_override != blank %}
          <h1 class="lom-product-hero__title">{{ section.settings.headline_override }}</h1>
        {% else %}
          <h1 class="lom-product-hero__title">{{ product.title }}</h1>
        {% endif %}

        {% if section.settings.subtitle != blank %}
          <p class="lom-product-hero__subtitle">{{ section.settings.subtitle }}</p>
        {% endif %}

        {%- comment -%} Live urgency banner {%- endcomment -%}
        {% if section.settings.show_urgency %}
          <div class="lom-urgency" id="lom-urgency-live">
            <div class="lom-urgency__bar">
              <div class="lom-urgency__progress" id="lom-urgency-progress" style="width:100%"></div>
            </div>

            {%- comment -%} Row 1: Shipping countdown {%- endcomment -%}
            <div class="lom-urgency__content">
              <span class="lom-urgency__icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--lt-gold, #c4937a)" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
              </span>
              <span class="lom-urgency__text" id="lom-ship-countdown">Order in <strong>--h --m</strong> to ship today</span>
            </div>

            {%- comment -%} Row 2: Live stock + free shipping {%- endcomment -%}
            <div class="lom-urgency__meta">
              <span class="lom-urgency__stock">
                <span class="lom-urgency__dot"></span>
                Selling fast â€” limited batch
              </span>
              <span class="lom-urgency__divider">Â·</span>
              <span class="lom-urgency__free-ship">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                Free shipping
              </span>
            </div>
          </div>

          <script>
            (function() {
              var el = document.getElementById('lom-ship-countdown');
              var bar = document.getElementById('lom-urgency-progress');
              if (!el) return;

              // Get current hour/minute in EST using Intl
              function getEST() {
                var parts = {};
                new Intl.DateTimeFormat('en-US', {
                  timeZone: 'America/New_York',
                  hour: 'numeric', minute: 'numeric', hour12: false,
                  weekday: 'short'
                }).formatToParts(new Date()).forEach(function(p) {
                  parts[p.type] = p.value;
                });
                return {
                  h: parseInt(parts.hour, 10),
                  m: parseInt(parts.minute, 10),
                  day: parts.weekday
                };
              }

              function update() {
                var est = getEST();
                var cutoffH = 15; // 3 PM EST
                var isWeekend = est.day === 'Sat' || est.day === 'Sun';
                var pastCutoff = est.h >= cutoffH;

                if (isWeekend || pastCutoff) {
                  el.innerHTML = 'Order now â€” <strong>ships next business day</strong>';
                  if (bar) bar.style.width = '100%';
                } else {
                  var remainH = cutoffH - est.h - 1;
                  var remainM = 60 - est.m;
                  if (remainM === 60) { remainM = 0; remainH++; }
                  el.innerHTML = 'Order in <strong>' + remainH + 'h ' + remainM + 'm</strong> to ship today';
                  var totalMin = cutoffH * 60;
                  var elapsedMin = est.h * 60 + est.m;
                  var pct = Math.max(0, Math.round((1 - elapsedMin / totalMin) * 100));
                  if (bar) bar.style.width = pct + '%';
                }
              }

              update();
              setInterval(update, 60000);
            })();
          </script>
        {% endif %}

        <div class="lom-product-hero__price" id="lom-price-display">
          <span class="lom-product-hero__price-compare" id="lom-price-compare">{{ product.price | times: 3 | money }}</span>
          <span class="lom-product-hero__price-current" id="lom-price-current">{{ price_3 | money }}</span>
          <span class="lom-product-hero__price-save" id="lom-price-save">Save 20%</span>
        </div>

        {%- comment -%} Variant picker {%- endcomment -%}
        {% if product.has_only_default_variant == false %}
          {% for option in product.options_with_values %}
            <div class="lom-product-hero__option">
              <label class="lom-product-hero__option-label">{{ option.name }}</label>
              <div class="lom-product-hero__option-values">
                {% for value in option.values %}
                  <button type="button" class="lom-product-hero__option-btn {% if option.selected_value == value %}is-active{% endif %}">{{ value }}</button>
                {% endfor %}
              </div>
            </div>
          {% endfor %}
        {% endif %}

        {%- comment -%} Bundle pricing (calculated outside conditional so ATC can use it) {%- endcomment -%}
        {% assign price_1 = product.price %}
        {% assign price_3 = product.price | times: 3 | times: 80 | divided_by: 100 %}
        {% assign price_5 = product.price | times: 5 | times: 70 | divided_by: 100 %}

        {%- comment -%} Bundle offer {%- endcomment -%}
        {% if section.settings.show_bundle %}
          <div class="lom-product-hero__bundles">
            <button type="button" class="lom-product-hero__bundle" data-quantity="1" data-bundle-price="{{ price_1 | money }}" data-bundle-name="Try It">
              <div class="lom-product-hero__bundle-radio"></div>
              <div class="lom-product-hero__bundle-info">
                <strong>Try It â€” 1 Stick</strong>
                <span>See what the hype is about</span>
              </div>
              <div class="lom-product-hero__bundle-price">{{ price_1 | money }}</div>
            </button>
            <button type="button" class="lom-product-hero__bundle lom-product-hero__bundle--popular is-active" data-quantity="3" data-bundle-price="{{ price_3 | money }}" data-bundle-name="Relief Pack">
              <span class="lom-product-hero__bundle-badge">Most Popular</span>
              <div class="lom-product-hero__bundle-radio"></div>
              <div class="lom-product-hero__bundle-info">
                <strong>Relief Pack â€” 3 Sticks</strong>
                <span>One for home. One for work. One for the gym.</span>
              </div>
              <div class="lom-product-hero__bundle-price">
                <small class="lom-product-hero__bundle-was">{{ product.price | times: 3 | money }}</small>
                {{ price_3 | money }}
                <span class="lom-product-hero__bundle-unit">{{ price_3 | divided_by: 3 | money }}/stick</span>
              </div>
            </button>
            <button type="button" class="lom-product-hero__bundle" data-quantity="5" data-bundle-price="{{ price_5 | money }}" data-bundle-name="Never Run Out">
              <span class="lom-product-hero__bundle-badge lom-product-hero__bundle-badge--value">Best Value</span>
              <div class="lom-product-hero__bundle-radio"></div>
              <div class="lom-product-hero__bundle-info">
                <strong>Never Run Out â€” 5 Sticks</strong>
                <span>Best price. Stock up for the year.</span>
              </div>
              <div class="lom-product-hero__bundle-price">
                <small class="lom-product-hero__bundle-was">{{ product.price | times: 5 | money }}</small>
                {{ price_5 | money }}
                <span class="lom-product-hero__bundle-unit">{{ price_5 | divided_by: 5 | money }}/stick</span>
              </div>
            </button>
          </div>
        {% endif %}

        {%- comment -%} Guarantee badges {%- endcomment -%}
        <div class="lom-product-hero__guarantees">
          <div class="lom-product-hero__guarantee">
            <span class="lom-product-hero__guarantee-icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg></span>
            <span>30-Day Guarantee</span>
          </div>
          <div class="lom-product-hero__guarantee">
            <span class="lom-product-hero__guarantee-icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="1" y="3" width="15" height="13"/><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg></span>
            <span>Free Shipping</span>
          </div>
          <div class="lom-product-hero__guarantee">
            <span class="lom-product-hero__guarantee-icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg></span>
            <span>Secure Checkout</span>
          </div>
        </div>

        {%- comment -%} Add to Cart {%- endcomment -%}
        {% form 'product', product, id: 'lom-product-form' %}
          <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
          <input type="hidden" name="quantity" value="3" id="lom-bundle-qty">
          <button type="submit" class="lom-btn-primary lom-btn-full lom-product-hero__atc" {% unless product.available %}disabled{% endunless %}
            data-atc-text="{{ section.settings.atc_text | default: 'Add to Cart' }}">
            {% if product.available %}
              {{ section.settings.atc_text | default: 'Add to Cart' }} â€” {{ price_3 | money }}
            {% else %}
              Sold Out
            {% endif %}
          </button>

          <div class="lom-product-hero__express-sep"><span>or checkout faster with</span></div>
          {{ form | payment_button }}
        {% endform %}

        {%- comment -%} Social proof buyers bar {%- endcomment -%}
        <div class="lom-hero-buyers">
          <div class="lom-hero-buyers__avatars">
            {% if section.settings.avatar_1 != blank %}
              <img class="lom-hero-buyers__avatar" src="{{ section.settings.avatar_1 | image_url: width: 80 }}" alt="Customer" style="z-index:4" loading="lazy">
            {% else %}
              <span class="lom-hero-buyers__avatar" style="background:#c5d9c7;z-index:4">S</span>
            {% endif %}
            {% if section.settings.avatar_2 != blank %}
              <img class="lom-hero-buyers__avatar" src="{{ section.settings.avatar_2 | image_url: width: 80 }}" alt="Customer" style="z-index:3" loading="lazy">
            {% else %}
              <span class="lom-hero-buyers__avatar" style="background:#e8c9b8;z-index:3">M</span>
            {% endif %}
            {% if section.settings.avatar_3 != blank %}
              <img class="lom-hero-buyers__avatar" src="{{ section.settings.avatar_3 | image_url: width: 80 }}" alt="Customer" style="z-index:2" loading="lazy">
            {% else %}
              <span class="lom-hero-buyers__avatar" style="background:#b8cfe8;z-index:2">J</span>
            {% endif %}
          </div>
          <span class="lom-hero-buyers__text">{{ section.settings.buyers_text | default: 'Sarah and 438 people purchased' }}</span>
        </div>

        {%- comment -%} Payment icons {%- endcomment -%}
        <div class="lom-hero-payments">
          <div class="lom-hero-payments__track">
            {%- comment -%} Visa {%- endcomment -%}
            <span class="lom-hero-payments__icon"><svg viewBox="0 0 38 24" xmlns="http://www.w3.org/2000/svg" width="38" height="24"><rect width="38" height="24" rx="3" fill="#fff" stroke="#e6e6e6" stroke-width=".5"/><path d="M16.3 16.1l1.4-6.7h1.8l-1.4 6.7zm7.3-6.5c-.4-.1-.9-.3-1.6-.3-1.8 0-3 .8-3 2 0 .9.9 1.3 1.6 1.6.7.3.9.5.9.8 0 .4-.6.6-1.1.6-.7 0-1.1-.1-1.7-.3l-.2-.1-.3 1.4c.4.2 1.2.3 2 .3 1.9 0 3.1-.8 3.1-2.1 0-.7-.5-1.2-1.5-1.6-.6-.3-1-.5-1-.8 0-.3.3-.5 1-.5.6 0 1 .1 1.3.2l.2.1.3-1.3zm4.7-.2h-1.4c-.4 0-.8.1-.9.5l-2.7 5.3h1.9l.4-1h2.3l.2 1h1.7l-1.5-5.8zm-2.2 3.8l1-2.3.5 2.3h-1.5zM14.8 9.4L13 14l-.2-.9c-.3-1-1.4-2-2.4-2.5l1.6 5.5h1.9l2.9-6.7h-2z" fill="#142688"/><path d="M11.2 9.4H8.3v.1c2.3.5 3.8 1.7 4.4 3.2l-.6-2.8c-.1-.4-.5-.5-.9-.5z" fill="#F7A600"/></svg></span>
            {%- comment -%} Mastercard {%- endcomment -%}
            <span class="lom-hero-payments__icon"><svg viewBox="0 0 38 24" xmlns="http://www.w3.org/2000/svg" width="38" height="24"><rect width="38" height="24" rx="3" fill="#fff" stroke="#e6e6e6" stroke-width=".5"/><circle fill="#EB001B" cx="15" cy="12" r="7"/><circle fill="#F79E1B" cx="23" cy="12" r="7"/><path fill="#FF5F00" d="M22 12c0-2.4-1.2-4.5-3-5.7-1.8 1.3-3 3.4-3 5.7s1.2 4.5 3 5.7c1.8-1.2 3-3.3 3-5.7z"/></svg></span>
            {%- comment -%} Amex {%- endcomment -%}
            <span class="lom-hero-payments__icon"><svg viewBox="0 0 38 24" xmlns="http://www.w3.org/2000/svg" width="38" height="24"><rect width="38" height="24" rx="3" fill="#fff" stroke="#e6e6e6" stroke-width=".5"/><path fill="#006FCF" d="M7 13.2L9.5 7h2.1l2.5 6.2h-2l-.5-1.1H9.2l-.5 1.1H7zm3.5-4.5L9.5 11h2l-1-2.3zM14.6 13.2V7h2.7l1.6 4.2L20.5 7h2.7v6.2h-1.7V8.8l-1.8 4.4h-1.5l-1.8-4.4v4.4h-1.8zM24.1 13.2V7h5.1v1.3h-3.4v1.1h3.3v1.2h-3.3v1.3h3.4v1.3h-5.1z"/></svg></span>
            {%- comment -%} PayPal {%- endcomment -%}
            <span class="lom-hero-payments__icon"><svg viewBox="0 0 38 24" xmlns="http://www.w3.org/2000/svg" width="38" height="24"><rect width="38" height="24" rx="3" fill="#fff" stroke="#e6e6e6" stroke-width=".5"/><path fill="#003087" d="M23.9 8.3c.2-1 0-1.7-.6-2.3-.6-.7-1.7-1-3.1-1h-4.1c-.3 0-.5.2-.6.5L14 15.6c0 .2.1.4.3.4h2.3l.6-3.5c.1-.3.3-.5.6-.5h1.3c2.5 0 4.5-1 5-4 0-.1.1-.5-.2-1.7z"/><path fill="#012169" d="M15.5 8.3c0-.2.1-.3.2-.4.1-.1.2-.1.3-.1h4c.5 0 .9 0 1.3.1.3.1.5.2.7.5.2-1 0-1.7-.6-2.3-.6-.7-1.7-1-3.1-1h-4.1c-.3 0-.5.2-.6.5L13 15.6c0 .2.1.4.3.4h2.3l1.9-7.7z"/></svg></span>
            {%- comment -%} Shop Pay {%- endcomment -%}
            <span class="lom-hero-payments__icon"><svg viewBox="0 0 38 24" xmlns="http://www.w3.org/2000/svg" width="38" height="24"><rect width="38" height="24" rx="3" fill="#5A31F4"/><path fill="#fff" d="M21.4 9.6c-.3 0-.5.1-.7.2V8h-1.2v5.6h1.1v-.3c.2.2.5.4.9.4.8 0 1.5-.7 1.5-1.7v-.7c0-1-.6-1.7-1.4-1.7zm.2 3.2c-.3 0-.6-.2-.7-.4v-1.2c.1-.3.4-.5.7-.5.5 0 .7.4.7.8v.5c0 .5-.3.8-.7.8zm-5-3.2c-.9 0-1.5.6-1.5 1.4 0 .7.3 1.1.9 1.3l.6.2c.3.1.5.2.5.5s-.2.4-.6.4c-.3 0-.7-.1-1.1-.4l-.4.8c.4.3 1 .5 1.5.5 1 0 1.5-.5 1.5-1.4 0-.7-.4-1.1-1-1.3l-.5-.2c-.3-.1-.4-.2-.4-.4s.2-.4.5-.4c.3 0 .6.1.9.3l.4-.8c-.4-.3-.9-.5-1.3-.5zm3.1 0c-.3 0-.6.1-.8.3v-.2h-1.1V16h1.2v-2.4c.2.2.5.3.8.3.8 0 1.4-.7 1.4-1.7v-.6c-.1-1-.7-1.7-1.5-1.7zm.2 3.1c-.3 0-.5-.1-.7-.4v-1.2c.1-.3.4-.5.7-.5.4 0 .7.4.7.8v.5c-.1.5-.3.8-.7.8zm6.7-3c-.3 0-.7.2-.9.4V8h-1.2v5.6h1.2v-2.6c0-.4.2-.7.5-.7.3 0 .5.2.5.7v2.6h1.2V11c0-1-.5-1.3-1.3-1.3zm-13 .1h-1.8V8.6h-1.2v1.1h-.8v1h.8v2c0 .9.5 1.4 1.3 1.4.4 0 .7-.1 1-.3l-.3-.9c-.2.1-.3.2-.5.2-.3 0-.4-.2-.4-.5v-1.9h.9v-1z"/></svg></span>
          </div>
        </div>

        {%- comment -%} Trust row: Safe Payment / Free Shipping / Fast Delivery {%- endcomment -%}
        <div class="lom-hero-trust-row">
          <div class="lom-hero-trust-row__item">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v2m0 8h.01"/><path d="M9.5 10.5a2.5 2.5 0 115 0c0 1.5-2.5 2-2.5 4"/></svg>
            <span>Safe Payment</span>
          </div>
          <div class="lom-hero-trust-row__item">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3 7h7l-5.5 4 2 7L12 16l-6.5 4 2-7L2 9h7z"/></svg>
            <span>Free Shipping</span>
          </div>
          <div class="lom-hero-trust-row__item">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
            <span>Fast Delivery</span>
          </div>
        </div>

        {%- comment -%} Featured review carousel {%- endcomment -%}
        {% assign review_blocks = section.blocks | where: 'type', 'review' %}
        {% if review_blocks.size > 0 %}
          <div class="lom-hero-review-carousel" id="lom-review-carousel">
            {% for block in review_blocks %}
              <div class="lom-hero-review-card {% if forloop.first %}is-active{% endif %}" {{ block.shopify_attributes }}>
                <div class="lom-hero-review-card__inner">
                  {% if block.settings.avatar != blank %}
                    <img class="lom-hero-review-card__avatar" src="{{ block.settings.avatar | image_url: width: 96 }}" alt="{{ block.settings.name }}" loading="lazy">
                  {% else %}
                    <div class="lom-hero-review-card__avatar">
                      {{ block.settings.name | truncate: 1, '' | upcase }}
                    </div>
                  {% endif %}
                  <div class="lom-hero-review-card__info">
                    <div class="lom-hero-review-card__name">
                      {{ block.settings.name }}
                      <span class="lom-hero-review-card__verified"><svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></span>
                    </div>
                    <div class="lom-hero-review-card__location">{{ block.settings.location }}</div>
                    <div class="lom-hero-review-card__stars"><span class="lom-star"></span><span class="lom-star"></span><span class="lom-star"></span><span class="lom-star"></span><span class="lom-star"></span></div>
                    <p class="lom-hero-review-card__text">{{ block.settings.text }}</p>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
          <div class="lom-hero-review-nav">
            <strong>{{ review_blocks.size }}</strong> <span>New Reviews</span>
            <div class="lom-hero-review-dots" id="lom-review-dots">
              {% for block in review_blocks %}
                <span class="lom-hero-review-dot {% if forloop.first %}is-active{% endif %}" data-index="{{ forloop.index0 }}"></span>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        {%- comment -%} Collapsible accordions {%- endcomment -%}
        {% assign accordion_blocks = section.blocks | where: 'type', 'accordion' %}
        {% if accordion_blocks.size > 0 %}
          <div class="lom-hero-accordions">
            {% for block in accordion_blocks %}
              <div class="lom-hero-accordion" {{ block.shopify_attributes }}>
                <button type="button" class="lom-hero-accordion__trigger" onclick="this.parentElement.classList.toggle('is-open')">
                  <span>{{ block.settings.heading }}</span>
                  <span class="lom-hero-accordion__icon">+</span>
                </button>
                <div class="lom-hero-accordion__content">
                  <div class="lom-hero-accordion__body">{{ block.settings.content }}</div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% endif %}

        {%- comment -%} UGC POV Videos {%- endcomment -%}
        {% assign ugc_blocks = section.blocks | where: 'type', 'ugc_video' %}
        {% if ugc_blocks.size > 0 %}
          <div class="lom-hero-ugc">
            <p class="lom-hero-ugc__label">See It in Action</p>
            <div class="lom-hero-ugc__grid">
              {% for block in ugc_blocks %}
                <div class="lom-hero-ugc__card" {{ block.shopify_attributes }} data-ugc-card>
                  {% if block.settings.poster != blank %}
                    <img class="lom-hero-ugc__poster" src="{{ block.settings.poster | image_url: width: 480 }}" alt="{{ block.settings.name | default: 'UGC video' }}" loading="lazy">
                  {% endif %}
                  {% if block.settings.video_url != blank %}
                    <video src="{{ block.settings.video_url }}" playsinline muted loop preload="none" data-ugc-video></video>
                  {% elsif block.settings.shopify_video != blank %}
                    {{ block.settings.shopify_video | video_tag: playsinline: true, muted: true, loop: true, preload: 'none', data-ugc-video: '' }}
                  {% endif %}
                  <button type="button" class="lom-hero-ugc__play" aria-label="Play video" data-ugc-play>
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><polygon points="6,3 20,12 6,21"/></svg>
                  </button>
                  <div class="lom-hero-ugc__caption">
                    {% if block.settings.name != blank %}
                      <span class="lom-hero-ugc__name">{{ block.settings.name }}</span>
                    {% endif %}
                    {% if block.settings.label != blank %}
                      <span class="lom-hero-ugc__tag">{{ block.settings.label }}</span>
                    {% endif %}
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        {% if section.settings.loss_aversion_text != blank %}
          <p class="lom-product-hero__loss-aversion">{{ section.settings.loss_aversion_text }}</p>
        {% endif %}
        {% if section.settings.fda_disclaimer != blank %}
          <p class="lom-fda-disclaimer">{{ section.settings.fda_disclaimer }}</p>
        {% endif %}
      </div>
    </div>
  </div>
</section>

{%- comment -%} Sticky mobile ATC bar {%- endcomment -%}
<div class="lom-sticky-atc" id="lom-sticky-atc">
  <div class="lom-sticky-atc__inner">
    <div class="lom-sticky-atc__info">
      <div class="lom-sticky-atc__title">{{ product.title }}</div>
      <div class="lom-sticky-atc__price">{{ product.price | money }}{% if product.compare_at_price > product.price %} <s style="color:var(--lom-text-light);font-size:12px">{{ product.compare_at_price | money }}</s>{% endif %}</div>
    </div>
    <button type="button" class="lom-sticky-atc__btn" onclick="document.getElementById('lom-product-form').querySelector('button[type=submit]').click()">
      Add to Cart
    </button>
  </div>
</div>

<script>
  // Bundle pricing data
  var lomUnitPrice = {{ product.price }};
  var lomBundleData = {
    '1': { price: lomUnitPrice, compare: 0, save: 0 },
    '3': { price: Math.round(lomUnitPrice * 3 * 0.8), compare: lomUnitPrice * 3, save: 20 },
    '5': { price: Math.round(lomUnitPrice * 5 * 0.7), compare: lomUnitPrice * 5, save: 30 }
  };

  function lomFormatMoney(cents) {
    return '$' + (cents / 100).toFixed(2);
  }

  // Bundle selector â€” updates quantity, CTA text, price display, and sticky bar
  document.querySelectorAll('.lom-product-hero__bundle').forEach(function(b){
    b.addEventListener('click', function(){
      document.querySelectorAll('.lom-product-hero__bundle').forEach(function(x){x.classList.remove('is-active')});
      this.classList.add('is-active');

      var qty = this.getAttribute('data-quantity');
      var price = this.getAttribute('data-bundle-price');
      var qtyInput = document.getElementById('lom-bundle-qty');
      var atcBtn = document.querySelector('.lom-product-hero__atc');
      var stickyBtn = document.querySelector('.lom-sticky-atc__btn');
      var stickyPrice = document.querySelector('.lom-sticky-atc__price');

      if (qtyInput) qtyInput.value = qty;

      if (atcBtn && atcBtn.dataset.atcText) {
        atcBtn.textContent = atcBtn.dataset.atcText + ' â€” ' + price;
      }

      if (stickyBtn) stickyBtn.textContent = 'Add to Cart â€” ' + price;
      if (stickyPrice) stickyPrice.innerHTML = price;

      // Update price display
      var data = lomBundleData[qty];
      var priceCompare = document.getElementById('lom-price-compare');
      var priceCurrent = document.getElementById('lom-price-current');
      var priceSave = document.getElementById('lom-price-save');

      if (data && priceCurrent) {
        priceCurrent.textContent = lomFormatMoney(data.price);
        if (data.compare > 0) {
          priceCompare.textContent = lomFormatMoney(data.compare);
          priceCompare.style.display = '';
          priceSave.textContent = 'Save ' + data.save + '%';
          priceSave.style.display = '';
        } else {
          priceCompare.style.display = 'none';
          priceSave.style.display = 'none';
        }
      }
    });
  });

  // Review carousel
  (function(){
    var cards = document.querySelectorAll('.lom-hero-review-card');
    var dots = document.querySelectorAll('.lom-hero-review-dot');
    if (cards.length < 2) return;
    var idx = 0;
    function show(i) {
      cards.forEach(function(c){ c.classList.remove('is-active'); });
      dots.forEach(function(d){ d.classList.remove('is-active'); });
      cards[i].classList.add('is-active');
      dots[i].classList.add('is-active');
      idx = i;
    }
    dots.forEach(function(d){
      d.addEventListener('click', function(){ show(parseInt(this.dataset.index)); });
    });
    setInterval(function(){ show((idx + 1) % cards.length); }, 5000);
  })();

  // UGC video play/pause
  document.querySelectorAll('[data-ugc-play]').forEach(function(btn) {
    btn.addEventListener('click', function() {
      var card = this.closest('[data-ugc-card]');
      var video = card.querySelector('video');
      if (!video) return;
      document.querySelectorAll('[data-ugc-card].is-playing').forEach(function(o) {
        if (o !== card) { o.classList.remove('is-playing'); var v = o.querySelector('video'); if (v) { v.pause(); v.currentTime = 0; } }
      });
      if (card.classList.contains('is-playing')) {
        card.classList.remove('is-playing');
        video.pause();
      } else {
        card.classList.add('is-playing');
        video.muted = false;
        video.play();
      }
    });
  });

  // Sticky mobile ATC
  (function(){
    var stickyEl = document.getElementById('lom-sticky-atc');
    var atcBtn = document.querySelector('.lom-product-hero__atc');
    if (!stickyEl || !atcBtn) return;
    var observer = new IntersectionObserver(function(entries){
      entries.forEach(function(e){
        if (e.isIntersecting) {
          stickyEl.classList.remove('is-visible');
        } else {
          stickyEl.classList.add('is-visible');
        }
      });
    }, { threshold: 0 });
    observer.observe(atcBtn);
  })();
</script>

{% schema %}
{
  "name": "Lom Product Hero",
  "settings": [
    {
      "type": "text",
      "id": "headline_override",
      "label": "Headline override (leave blank for product title)",
      "default": "Traditional Herbal Support for Headaches, Fatigue & Congestion â€” Without Chemicals, Caffeine, or Crashes"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Product subtitle",
      "default": "The century-old Thai herbal stick that 10,000+ nurses, athletes & professionals carry daily"
    },
    {
      "type": "text",
      "id": "review_count",
      "label": "Review count",
      "default": "1,200+"
    },
    {
      "type": "text",
      "id": "atc_text",
      "label": "Add to cart text",
      "default": "Add to Cart"
    },
    {
      "type": "checkbox",
      "id": "show_bundle",
      "label": "Show bundle offers",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_urgency",
      "label": "Show urgency timer",
      "default": true
    },
    {
      "type": "text",
      "id": "urgency_text",
      "label": "Urgency text",
      "default": "Limited batch â€” ships within 24 hours"
    },
    {
      "type": "text",
      "id": "urgency_subtext",
      "label": "Urgency subtext",
      "default": "Free shipping on every order"
    },
    {
      "type": "text",
      "id": "buyers_text",
      "label": "Buyers social proof text",
      "default": "Sarah and 89 people this week"
    },
    {
      "type": "image_picker",
      "id": "avatar_1",
      "label": "Buyer avatar 1"
    },
    {
      "type": "image_picker",
      "id": "avatar_2",
      "label": "Buyer avatar 2"
    },
    {
      "type": "image_picker",
      "id": "avatar_3",
      "label": "Buyer avatar 3"
    },
    {
      "type": "text",
      "id": "loss_aversion_text",
      "label": "Loss aversion closing line",
      "default": "Still thinking? Every day without this is another day reaching for chemicals that don't actually solve the problem."
    },
    {
      "type": "textarea",
      "id": "fda_disclaimer",
      "label": "FDA disclaimer",
      "default": "* These statements have not been evaluated by the Food and Drug Administration. This product is not intended to diagnose, treat, cure, or prevent any disease."
    }
  ],
  "blocks": [
    {
      "type": "benefit",
      "name": "Key benefit",
      "settings": [
        {
          "type": "text",
          "id": "icon",
          "label": "Icon",
          "default": "âš¡"
        },
        {
          "type": "text",
          "id": "text",
          "label": "Benefit text",
          "default": "Works in seconds, not minutes"
        }
      ]
    },
    {
      "type": "review",
      "name": "Featured review",
      "settings": [
        {
          "type": "image_picker",
          "id": "avatar",
          "label": "Reviewer photo"
        },
        {
          "type": "text",
          "id": "name",
          "label": "Reviewer name",
          "default": "Sarah K."
        },
        {
          "type": "text",
          "id": "location",
          "label": "Location",
          "default": "Los Angeles"
        },
        {
          "type": "textarea",
          "id": "text",
          "label": "Review text",
          "default": "This thing is magic. Instant relief from my sinus headaches."
        }
      ]
    },
    {
      "type": "accordion",
      "name": "Accordion tab",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Description"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>Accordion content here.</p>"
        }
      ]
    },
    {
      "type": "ugc_video",
      "name": "UGC Video",
      "limit": 6,
      "settings": [
        {
          "type": "image_picker",
          "id": "poster",
          "label": "Poster / thumbnail image"
        },
        {
          "type": "text",
          "id": "video_url",
          "label": "Video URL (MP4 link)"
        },
        {
          "type": "video",
          "id": "shopify_video",
          "label": "Or upload a Shopify video"
        },
        {
          "type": "text",
          "id": "name",
          "label": "Creator name",
          "default": "Sarah M."
        },
        {
          "type": "text",
          "id": "label",
          "label": "Caption",
          "default": "Verified Buyer"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Lom Product Hero",
      "blocks": [
        { "type": "benefit", "settings": { "icon": "âš¡", "text": "Works in seconds, not minutes" } },
        { "type": "benefit", "settings": { "icon": "ðŸŒ¿", "text": "5 natural plant-based ingredients" } },
        { "type": "benefit", "settings": { "icon": "ðŸ’°", "text": "One $8 stick lasts months of daily use" } },
        { "type": "review", "settings": { "name": "Sarah K.", "location": "Los Angeles", "text": "This thing is magic. Instant relief from my sinus headaches. I carry it everywhere now." } },
        { "type": "review", "settings": { "name": "James M.", "location": "New York", "text": "As a truck driver, this is a lifesaver. One sniff and I'm alert again." } },
        { "type": "review", "settings": { "name": "Anna P.", "location": "Netherlands", "text": "My whole family uses these. Best natural remedy we've found." } },
        { "type": "review", "settings": { "name": "Michelle T.", "location": "Texas", "text": "Working 12-hour nursing shifts, this keeps me going. Natural and it actually works." } },
        { "type": "accordion", "settings": { "heading": "Description", "content": "<p>When you need a moment of comfort during a long day â€” one roll on your temples and you feel the soothing herbal blend. No water needed. No waiting.</p><p>Siam Lom is a 2-in-1 nasal inhaler and roller made from 5 natural Thai herbs. Traditionally used in Thailand for over a century to promote comfort and well-being.</p>" } },
        { "type": "accordion", "settings": { "heading": "Common Questions", "content": "<p><strong>Is this just a Vicks knockoff?</strong><br>Vicks is petroleum-based with synthetic menthol made in a factory. Siam Lom uses pure plant extracts in a century-old Thai formula passed down through generations of herbalists. Different heritage. Different ingredients. Different universe.</p><p><strong>What if I don't like it?</strong><br>Email us. Full refund. No forms. No shipping it back. No restocking fee. We can afford this because 97% of people keep it.</p>" } },
        { "type": "accordion", "settings": { "heading": "Shipping & Delivery", "content": "<p>Ships within 24 hours. Arrives in 3â€“5 business days (US). Free on every order.</p><p>EU orders ship free and arrive in 5â€“10 business days.</p>" } },
        { "type": "accordion", "settings": { "heading": "1-Year Quality Guarantee", "content": "<p>If your Siam Lom stick dries out within 12 months, we replace it free. No receipt needed, no fine print â€” just email us and we'll send a fresh one.</p>" } }
      ]
    }
  ]
}
{% endschema %}
